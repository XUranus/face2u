(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{347:function(e,t,a){e.exports=a(856)},352:function(e,t,a){},353:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},354:function(e,t,a){},383:function(e,t){},385:function(e,t){},418:function(e,t){},419:function(e,t){},856:function(e,t,a){"use strict";a.r(t);var n=a(5),r=a.n(n),c=a(111),o=a.n(c),i=(a(352),a(35)),s=a(36),u=a(48),l=a(47),h=a(49),d=(a(353),a(354),a(53)),m=a.n(d),p=a(112),v=a(142),f=a(338),g=a.n(f),w=a(346),y=a(341),b=a.n(y),E=a(343),x=a.n(E),k=a(345),j=a.n(k),O=a(344),B=a.n(O),I=a(339),C=a.n(I),S=a(22),T=a(340),D=a.n(T),N=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.data[0];console.log("new echart render",e);var t=t={xAxis:{type:"category",data:["\u6124\u6012","\u6076\u5fc3","\u6050\u60e7","\u5feb\u4e50","\u60b2\u4f24","\u60ca\u8bb6","\u81ea\u7136"]},yAxis:{type:"value"},series:[{data:e,type:"bar"}]};return console.log(t),r.a.createElement(D.a,{option:t})}}]),t}(n.Component),A=640,z=480,L={card:{minWidth:275},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},title:{fontSize:14},pos:{marginBottom:12},overlay:{width:A,height:z,position:"absolute"},video:{"z-index":-1}};var M=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={capturedImage:"",forwardTimes:[]},a.setRef=function(e){a.webcam=e},a.capture=Object(p.a)(m.a.mark(function e(){var t,n,r,c,o,i,s,u;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.webcam.getScreenshot(),a.setState({capturedImage:t}),n=Object(v.a)(a),r=document.getElementById("snapshot"),e.next=6,S.b(r);case 6:c=e.sent,o=S.h(c,{width:r.width,height:r.height}),(i=document.getElementById("snapshot-canvas")).width=r.width,i.height=r.height,S.c(i,o,{withScore:!0}),0==c.length?alert("\u6ca1\u6709\u6355\u83b7\u5230\u9762\u90e8!"):(s=c[0],(u=new Image).src=t,u.onload=function(){var e=document.getElementById("cutted").getContext("2d"),t=s.relativeBox.x*A,a=s.relativeBox.y*z,r=s.relativeBox.width*A,c=s.relativeBox.height*z;e.drawImage(u,t,a,r,c,0,0,100,100);var o=e.getImageData(0,0,100,100);console.log(o),C()({method:"post",url:"http://localhost:5000/face_img",crossDomain:!0,data:{msg:"face snapshot",matrix:o,width:100,height:100}}).then(function(e){console.log(e.data),n.props.updateEcharts(e.data.data)}).catch(function(e){console.log(e)})});case 13:case"end":return e.stop()}},e)})),a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"recognizeFace",value:function(){var e=Object(p.a)(m.a.mark(function e(){var t,a,n,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("snapshot"),(a=document.getElementById("overlay")).width=t.width,a.height=t.height,e.next=6,S.b(t);case 6:n=e.sent,console.log(n),r=S.h(n,{width:t.width,height:t.height}),console.log(r),S.c(a,r,{withScore:!0});case 11:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(p.a)(m.a.mark(function e(){var t;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=document.getElementsByTagName("video")[0]).setAttribute("id","webcam"),e.next=4,S.g.ssdMobilenetv1.load("/models");case 4:return e.next=6,S.f("/models");case 6:return console.log("models load succ"),e.next=9,this.onPlay(t);case 9:console.log("camera video inited");case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"updateTimeStats",value:function(e){var t=this.state.forwardTimes;(t=[e].concat(t).slice(0,30)).reduce(function(e,t){return e+t}),t.length;this.setState({forwardTimes:t})}},{key:"resizeCanvasAndResults",value:function(e,t,a){var n=e instanceof HTMLVideoElement?S.e(e):e,r=n.width,c=n.height;return t.width=r,t.height=c,S.h(a,{width:r,height:c})}},{key:"drawDetections",value:function(e,t,a){var n=function(e,t,a){var n=e instanceof HTMLVideoElement?S.e(e):e,r=n.width,c=n.height;return t.width=r,t.height=c,S.h(a,{width:r,height:c})}(e,t,a);S.c(t,n)}},{key:"drawLandmarks",value:function(e,t,a){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=this.resizeCanvasAndResults(e,t,a);n&&S.c(t,r.map(function(e){return e.detection}));var c=r.map(function(e){return e.landmarks});S.d(t,c,{lineWidth:2,drawLines:!0,color:"green"})}},{key:"onPlay",value:function(){var e=Object(p.a)(m.a.mark(function e(t){var a,n,r,c,o,i,s=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.currentTime&&!t.paused&&!t.ended){e.next=2;break}return e.abrupt("return",setTimeout(function(){return s.onPlay(t)}));case 2:if(512,.5,a=!1,n=!0,r=new S.a({inputSize:512,scoreThreshold:.5}),c=Date.now(),o=S.b(t,r),!a){e.next=15;break}return e.next=12,o.withFaceLandmarks();case 12:e.t0=e.sent,e.next=18;break;case 15:return e.next=17,o;case 17:e.t0=e.sent;case 18:i=e.t0,this.updateTimeStats(Date.now()-c),(a?this.drawLandmarks:this.drawDetections)(t,document.getElementById("overlay"),i,n),setTimeout(function(){return s.onPlay(t)});case 23:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props.classes;return r.a.createElement("div",null,r.a.createElement(b.a,{className:e.card},r.a.createElement("div",{id:"extraMount"}),r.a.createElement(x.a,null,r.a.createElement(B.a,{className:e.title,color:"textSecondary",gutterBottom:!0},"Web Camera"),r.a.createElement("div",null,r.a.createElement("canvas",{className:e.overlay,id:"overlay"}),r.a.createElement(g.a,{id:"webcam",className:e.video,audio:!1,width:A,height:z,ref:this.setRef,screenshotFormat:"image/jpeg",videoConstraints:{width:320,height:240,facingMode:"user"}})),r.a.createElement(j.a,{variant:"contained",color:"primary",className:e.button,onClick:this.capture},"Capture"),r.a.createElement("div",null,r.a.createElement("canvas",{className:e.overlay,id:"snapshot-canvas"}),r.a.createElement("img",{className:e.video,id:"snapshot",src:this.state.capturedImage,alt:"captured"})))),r.a.createElement("canvas",{id:"cutted"}))}}]),t}(n.Component),W=Object(w.withStyles)(L)(M),P=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).state={echartsData:null},a}return Object(h.a)(t,e),Object(s.a)(t,[{key:"updateEcharts",value:function(e){this.setState({echartsData:e})}},{key:"render",value:function(){var e=this.state.echartsData;return r.a.createElement("div",null,r.a.createElement(W,{updateEcharts:this.updateEcharts.bind(this)}),null===e?null:r.a.createElement(N,{data:this.state.echartsData}))}}]),t}(n.Component),R=(n.Component,function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{style:{margin:"10px"}},r.a.createElement(P,null))}}]),t}(n.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(R,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[347,1,2]]]);
//# sourceMappingURL=main.fbbc90a8.chunk.js.map